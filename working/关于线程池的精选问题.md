---
title: 关于线程池的精选问题
date: 2021-07-16 15:13:00
categories: [后端]
tags: [interview,java,多线程]
description: "易错点，重点笔记"
cover_picture: http://oss.willhappy.cn/hexo/cover_pic/cover_picture_34.jpg

---

> 问：在网上搜索,都只会讲类似使用
`ExecutorService s = Executors.newFixedThreadPool(5);`
这种方式来创建
我想问的是: 在一个请求需要处理很复杂的运算时,使用线程池,
那么是直接在方法里面 new 一个出来,使用完之后关闭掉?
还是使用单例模式创建一个全局的线程池.
我不是很理解这个
如果说每次请求 new 一个线程池出来的话,
在高并发下,是不是存在很多个线程池,那么内存应该会溢出的啊.
但如果只创建一个线程池,
在高并发下,无数的请求都排队使用那几个固定的线程,不是更慢了吗?
java 里面每个 web 请求过来都是一个线程,不使用线程池的话,
自己的线程处理自己的事情,比所有请求共用一个线程池快得多吧.
我不知道我这么想对不对.但是我使用 apache 的 ab 同时请求 1000 次的话,
不使用线程池比使用单例的线程池快很多很多.
希望大佬来帮小弟解惑.
                        --取自：segmentfault《线程池在项目中怎么使用的疑惑》

答：我觉得回答这个问题，首先要从线程池的特点来答。

开辟一个线程池比代码独立开辟几个线程相比，线程池内的资源可控，线程资源利用率高，能够减少频繁创建销毁线程的开销，维护起来比较简单，线程池内的核心线程数、最大线程数、等待队列、线程名、拒绝策略等可以过设置规则来生成，如果出了问题可以通过排查线程栈快速定位到相关位置。

接下来回答楼主问题：

1、“在一个请求需要处理很复杂的运算时”，如果是一个请求处理很复杂的运算，这里分两种情况，一种CPU密集型，一种是IO密集型，如果是前者，开辟线程池并不能带来多少的性能提升，因为CPU密集型的运算通过多线程并不能提高多少性能；如果是后者，那么线程池的真正作用就完全发挥出来了，将会带给你飞一般的体验。

2、在项目中，一般一个任务对应一个线程池，这些线程池一般在系统启动或者首次执行到该业务时完成初始化，比如说线程池A负责接收用户请求，线程池B负责处理业务逻辑（参考reactor模式）。

3、极少出现只开辟一个线程池处理所有任务，这样不同任务的资源分配粒度无法控制，同时维护起来相当困难，个人认为违背了开发的原则。

4、很少说会出现开辟非常多线程池的情况，一般项目中，需要开辟线程的业务并不会占很大部分，我觉得这个项目中超过20个线程池，那应该是一个极其笨重的项目了，这个时候已经可以考虑拆分项目了。

最后，学习线程池建议先学会使用ThreadPoolExecutor，Executors是对ThreadPoolExecutor几种线程池的封装。学习ThreadPoolExecutor你会更加明白线程池的原理，适用的业务场景以及存在的意义。

有什么不对的，欢迎指正。

回复


