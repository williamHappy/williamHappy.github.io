---
title: å°ç»¿ğŸ”’httpsçš„webå®¹å™¨é…ç½®
date: 2018-04-25
categories: [åç«¯]
tags: [Linux]
description: "å®‰è£…é…ç½®https"
cover_picture: http://img.willhappy.cn/hexo/cover_pic/cover_picture_21.jpg

---

å­¦ä¹ é…ç½®https,ä»¥åŠä¸€äº›æœåŠ¡å™¨å®‰è£…éƒ¨ç½²æµç¨‹ï¼Œåœ¨tomcatå’Œnginxä¸­å®‰è£…é…ç½®httpsã€‚

<!--more-->

[toc]

### ä¸€. é˜¿é‡Œäº‘å…è´¹è¯ä¹¦çš„ç”³è¯·ä¸‹è½½
å‚è€ƒï¼š`https://common-buy.aliyun.com/?spm=5176.2020520163.cas.85.3b102b7arJW2wy&commodityCode=cas#/buy`  [ä¼ é€é—¨][1]
è´­ä¹°æˆåŠŸåï¼ŒæŒ‰ç…§å¯¹åº”æµç¨‹ä¸‹è½½é…ç½®ã€‚
ç›¸å…³é…ç½®å‚è€ƒï¼š`https://help.aliyun.com/video_detail/54217.html?spm=5176.2020520163.cas.80.3b102b7arJW2wy` [ä¼ é€é—¨][2]
### äºŒ. é…ç½®æ³¨æ„é—®é¢˜
1. ç«¯å£å·çš„æ›´æ”¹ï¼Œhttpsé»˜è®¤çš„ç«¯å£å·ä¸º443.
2. è¯ä¹¦è·¯å¾„çš„ä¿®æ”¹
3. åè®®çš„ä¿®æ”¹
4. è¯ä¹¦å¯†ç çš„ä¿®æ”¹

blogç›¸å…³å‚è€ƒï¼š `http://imtianx.cn/2017/09/22/tomcat_set_https/` [ä¼ é€é—¨][3]

### ä¸‰. é˜²ç«å¢™ç«¯å£çš„å¼€æ”¾
```
vim /etc/sysconfig/iptables
```
åœ¨æ–‡ä»¶ä¸­æ·»åŠ ï¼š
> -A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨é˜¿é‡Œäº‘çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œå»è®¾ç½®å®‰å…¨ç»„ç­–ç•¥æ¥å¼€æ”¾ç«¯å£ã€‚

### å››. æµ‹è¯•
é‡å¯tomcatï¼Œä½¿ç”¨`https://willhappy.cn`æµ‹è¯•ã€‚

### äº”. ç•ªå¤–(nginx + tomcat + https)
> ä¸Šé¢è¯´äº†å…³äºwebé¡¹ç›®å•ç‹¬åœ¨tomcatå®¹å™¨ä¸­é…ç½®https, ä½†æ˜¯ï¼Œç°åœ¨ç°åœ¨å¤§éƒ¨ä¼ä¸šéƒ½æ˜¯é‡‡ç”¨nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œtomcatåªåšæ•°æ®æœåŠ¡çš„æä¾›è€…ï¼Œæ‰€ä»¥ï¼Œç®€å•å†è¯´ä¸‹å…³äºnginxçš„httpsè¯ä¹¦å®‰è£…å’Œé…ç½®ã€‚

#### 1. å…³äºnginxå®‰è£…
ç½‘ä¸Šå·²ç»ç›¸å½“å¤šäº†ï¼Œå¯å‚è€ƒ[ä¼ é€é—¨][4].

#### 2. nginxé…ç½®httpsè¯ä¹¦
ç±»ä¼¼ä¸tomcatçš„httpsé…ç½®ï¼Œå‚è€ƒ[ä¼ é€é—¨][5], è§†é¢‘å‚è€ƒ[ä¼ é€é—¨][6].
æˆ‘çš„é…ç½®æ–‡ä»¶`nginx.conf`ï¼š
```
server {
    listen 443;
    server_name willhappy.cn;   #æ‹¦æˆªçš„åŸŸå
    ssl on;
    root html;
    index index.html index.htm;
    ssl_certificate   cert/XX.pem;  #ä½ è‡ªå·±ç”³è¯·çš„è¯ä¹¦æ–‡ä»¶
    ssl_certificate_key  cert/XX.key;  #ç§é’¥æ–‡ä»¶
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://whome;    #æä¾›æ•°æ®æœåŠ¡çš„æœåŠ¡å™¨
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

upstream whome{
    server localhost:8080;
}

```

> é…ç½®tomcatçš„server.xmlå¯ç›´æ¥é€šè¿‡ipè¿›è¡Œé¡¹ç›®çš„è®¿é—®

```
<Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true"
            xmlValidation="false" xmlNamespaceAware="false">
    <Context path="" docBase="/usr/local/tomcat/webapps/whome" reloadable="true" />
</Host>
```

#### 3. å¯åŠ¨æµ‹è¯•
å¯åŠ¨nginxï¼Œå¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼š
> [emerg] 10464#0: unknown directive "ssl" in /usr/local/nginx-0.6.32/conf/nginx.conf:74

è¿™æ˜¯å› ä¸ºæ²¡æœ‰å°†sslæ¨¡å—ç¼–è¯‘è¿›nginxï¼Œåœ¨configureçš„æ—¶å€™åŠ ä¸Šâ€œ--with-http_ssl_moduleâ€å³å¯
```
[root@localhost nginx-1.4.4]# ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_stub_status_module --with-http_ssl_module
```
nginxå®‰è£…åŒ…ä¸­é‡æ–°é…ç½®ï¼Œç¼–è¯‘ã€‚
å†æ¬¡é€šè¿‡`https://willhappy.cn`,è®¿é—®æµ‹è¯•ï¼Œé…ç½®æˆåŠŸã€‚

> æ³¨æ„ï¼šæˆ‘ä»¬åªèƒ½é€šè¿‡https://willhappy.cn æ–¹å¼è®¿é—®æ‰æ˜¯å®‰å…¨è®¿é—®ï¼Œé€šè¿‡willhappy.cnè¿˜æ˜¯æ™®é€šçš„httpè®¿é—®ï¼Œæ‰€ä»¥ï¼Œè¦é€šè¿‡ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®‰å…¨è®¿é—®ï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸‹ã€‚

å‚è€ƒ[ä¼ é€é—¨][7]ï¼Œæœªåšæµ‹è¯•ã€‚å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹ï¼Œå˜»å˜»


  [1]: https://common-buy.aliyun.com/?spm=5176.2020520163.cas.85.3b102b7arJW2wy&commodityCode=cas#/buy
  [2]: https://help.aliyun.com/video_detail/54217.html?spm=5176.2020520163.cas.80.3b102b7arJW2wy
  [3]: http://imtianx.cn/2017/09/22/tomcat_set_https/
  [4]: http://blog.willhappy.cn/2017/06/14/19_2017-06-14_%E5%9C%A8Linux%E4%B8%8A%E6%90%AD%E5%BB%BANginx%E6%9C%8D%E5%8A%A1%E5%99%A8/
  [5]: https://yundun.console.aliyun.com/?spm=5176.2020520001.aliyun_sidebar.15.x8wSsv&p=cas#/cas/download/214404469580275?regionId=
  [6]: https://help.aliyun.com/video_detail/54216.html?spm=5176.2020520163.cas.44.1ea12b7a93Ji91
  [7]: https://blog.csdn.net/will5451/article/details/79132093
