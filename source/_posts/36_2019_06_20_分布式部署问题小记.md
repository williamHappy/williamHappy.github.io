---
title: éƒ¨ç½²ç›¸å…³å°è®°
date: 2019-06-20 00:39:00
categories: [è¿ç»´]
tags: [Linux,java,https]
description: "æ˜“é”™ç‚¹ï¼Œé‡ç‚¹ç¬”è®°"
cover_picture: http://oss.willhappy.cn/hexo/cover_pic/cover_picture_34.jpg

---

  ä¸€æ¬¡é¡¹ç›®åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œé‡åˆ°ç›¸å…³é—®é¢˜çš„æ€»ç»“ç¬”è®°ã€‚

<!--more-->

[toc]

æœåŠ¡å™¨ç»“æ„å›¾ï¼š

![2019-9-5-23-35-15.png](http://oss.willhappy.cn/hexo/img/2019-9-5-23-35-15.png-willhappy)

## springboot jarå¯åŠ¨åº”ç”¨

è¿™ä¸ªä¸»è¦æ˜¯åœ¨éƒ¨ç½²ä¸Šå±‚ä¸šåŠ¡å¹³å°æ—¶é‡åˆ°é…ç½®æ–‡ä»¶åå¤ä¿®æ”¹æ—¶éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å»ºè®®ï¼Œå°†é…ç½®æ–‡ä»¶å¤–ç½®ï¼Œå¯ç›´æ¥æœåŠ¡å™¨ä¸Šä¿®æ”¹ã€‚

### é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºã€åŸåˆ™

SpringBooté¡¹ç›®å¯åŠ¨ä¼šå»æ‰«æä»¥ä¸‹ç›®å½•ä½ç½®çš„application.ymlæˆ–application.propertiesé…ç½®æ–‡ä»¶æ¥åŠ è½½beanã€‚

**é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š**

1. file:./config/  - ä¼˜å…ˆçº§æœ€é«˜ï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„configï¼Œå³å’ŒjaråŒ…åŒçº§ç›®å½•çš„/config/ï¼‰
2. file:./  - ä¼˜å…ˆçº§ç¬¬äºŒ  -ï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹, å³jaråŒ…æ‰€åœ¨ç›®å½•ï¼‰
3. classpath:/config/  - ä¼˜å…ˆçº§ç¬¬ä¸‰ï¼ˆé¡¹ç›®resources/configä¸‹ï¼Œå³jaråŒ…å†…/classes/config/ï¼‰
4. classpath:/  - ä¼˜å…ˆçº§ç¬¬å››ï¼ˆé¡¹ç›®resourcesæ ¹ç›®å½•, å³jaråŒ…å†…/classes/ï¼‰

```js
---
  |-- springboot-demo.jar
     |-- BOOT-INF
        |-- classes
          |-- config
            |-- â‘¢application.yml
          |-- â‘£application.yml
  |-- config
     |-- â‘ application.yml
  |-- â‘¡application.yml
```

**åŸåˆ™ï¼š**

- `é«˜ä¼˜å…ˆçº§`é…ç½®ä¼šè¦†ç›–`ä½ä¼˜å…ˆçº§`é…ç½®
- å¤šä¸ªé…ç½®æ–‡ä»¶`äº’è¡¥`

**å°æ€»ç»“ï¼š**

ä½¿ç”¨ï¼š

```shell
> java -jar demo.jar --spring.config.location=/opt/config/application.properties
```

ä½¿ç”¨å‘½ä»¤æŒ‡å®šjarå¤–éƒ¨çš„é…ç½®æ–‡ä»¶æˆ–è€…ç›´æ¥é…ç½®jaråŒ…çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨æµ‹è¯•æˆ–ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿåœ°ä¿®æ”¹é…ç½®å‚æ•°å€¼ï¼Œè€Œä¸éœ€è¦é‡æ–°æ‰“åŒ…å’Œéƒ¨ç½²åº”ç”¨ã€‚

**å¦å®‰åˆ©å‡ ç¯‡å¹²è´§ï¼š**

- [å®˜æ–¹springbooté…ç½®api][1]
- [Spring Boot å¤šç¯å¢ƒé…ç½®æœ€ä½³å®è·µ][2]
- [Spring Boot 2.xåŸºç¡€æ•™ç¨‹ï¼šé…ç½®æ–‡ä»¶è¯¦è§£][3]
- [å²ä¸Šæœ€å…¨çš„Spring Booté…ç½®æ–‡ä»¶è¯¦è§£][4]

## å†…ç½‘æœåŠ¡å™¨é—´å…±äº«æŒ‚è½½

è¦å®ç°é›†ç¾¤ä¹‹é—´å…±äº«çš„æ–‡ä»¶ï¼ˆé™æ€èµ„æºï¼‰çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡æŒ‚è½½æ–¹å¼å®ç°ã€‚å³å°†å…±äº«æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°ä¸€å°å…±äº«æ–‡ä»¶çš„æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡æŒ‚è½½çš„å½¢å¼ï¼Œè®¿é—®è¿™äº›å…±äº«æ–‡ä»¶ã€‚
å…·ä½“å®ç°æ“ä½œï¼Œå‚è€ƒ[æ–‡ç« ][5]

ä½¿ç”¨åˆ°çš„å‘½ä»¤ï¼š

```shell
// æŸ¥çœ‹ç£ç›˜æŒ‚è½½æƒ…å†µ
$ df â€“h

// æŒ‚è½½
$ mount Â­t nfs 192.168.0.199:/upload /home/web/upload

// å–æ¶ˆæŒ‚è½½
$ umount /home/web/upload
```

## httpsæ··åˆhttpè¯·æ±‚çš„é—®é¢˜

è¿™ä¸ªé—®é¢˜æ˜¯åœ¨è§†é¢‘éƒ½æ˜¯ä½¿ç”¨httpçš„ï¼Œå½“httpsç½‘ç«™å»ä½¿ç”¨httpè¯·æ±‚æ‹‰æµæ—¶å‡ºç°ï¼Œå‡ºæŠ¥é”™ã€‚
![2019-9-7-13-44-35.png](http://oss.willhappy.cn/hexo/img/2019-9-7-13-44-35.png-willhappy)

åƒè¿™ç§ï¼ŒHTTPSé¡µé¢æ··åˆä¸å®‰å…¨çš„HTTPè¯·æ±‚ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿé‚£å°±æ˜¯æŠŠä¸å®‰å…¨çš„httpè¯·æ±‚å‡çº§ä¸ºhttpsè¯·æ±‚ã€‚
æ–¹æ³•å‚è€ƒ[æ–‡ç« ][6]

## cdné˜²ç›—é“¾æ‹¦æˆªé™æ€èµ„æº

è¿™ä¸ªæ˜¯åœ¨ä½¿ç”¨`cdn`ä¸­ï¼Œå»æ‹‰å–`flash`èµ„æºå­˜åœ¨è·¨åŸŸï¼Œä¼šè§¦å‘è¯·æ±‚è·¨åŸŸç­–ç•¥æ–‡ä»¶`crossdomain.xml`çš„æƒ…å†µ, è€Œåœ¨è¯·æ±‚ç±»ä¼¼è¿™ç§é™æ€èµ„æºæ—¶ï¼Œcdnå¦‚æœè®¾ç½®äº†æ¯”è¾ƒé«˜çº§çš„é˜²ç›—é“¾æªæ–½ï¼Œåˆ™è¿™ç§è¯·æ±‚ä¼šè¢«æ‹¦æˆªæ‰ï¼Œæ‰€ä»¥ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œåœ¨`cdné˜²ç›—é“¾`é…ç½®ä¸­è¿‡æ»¤æ‰å¯¹è¿™ç§æ–‡ä»¶çš„æ‹¦æˆªï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸çš„è¯·æ±‚åˆ°flashèµ„æºäº†ã€‚

## è¿›ç¨‹ç®¡ç†Supervisorä½¿ç”¨

`Supervisor`æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿï¼Œé‡‡ç”¨ `Python(2.4+)` å¼€å‘çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…è®¸ç”¨æˆ·ç®¡ç†ï¼ŒåŸºäº `Unix` ç³»ç»Ÿè¿›ç¨‹çš„ `Client/Server` ç³»ç»Ÿï¼Œæä¾›äº†å¤§é‡åŠŸèƒ½æ¥å®ç°å¯¹è¿›ç¨‹çš„ç®¡ç†ã€‚

### å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨

```shell
// å®‰è£…
$ yum install supervisor

// å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
$ systemctl start supervisord.service
$ systemctl enable supervisord.service

```

### åº”ç”¨é…ç½®

yumå®‰è£…å®Œæˆä¹‹åï¼Œä¼šç”Ÿæˆ`/etc/supervisord.conf`ä¸»é…ç½®æ–‡ä»¶å’Œä¸€ä¸ª`/etc/supervisord.d` è‡ªé…ç½®æ–‡ä»¶ç›®å½•.

(1) æˆ‘ä»¬å¯ä»¥å…ˆåœ¨è‡ªå®šä¹‰é…ç½®ç›®å½•åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹`conf`å’Œ`log`æ¥å­˜æ”¾æˆ‘ä»¬å„ä¸ªåº”ç”¨çš„é…ç½®å’Œæ—¥å¿—ã€‚

```shell
// åˆ›å»ºæ–‡ä»¶å¤¹
$ cd /etc/supervisord.d && mkdir conf log

// æ¯”å¦‚åˆ›å»ºä¸€ä¸ªmanager.confçš„é…ç½®
$ cd /etc/supervisord.d/conf
$ vim manager.conf
```

(2) å„åº”ç”¨é…ç½®è‡ªå®šä¹‰é…ç½®

æˆ‘ä»¬ç°åœ¨åˆ›å»ºä¸€ä¸ªä½¿ç”¨springbootæ„å»ºçš„javaåº”ç”¨é…ç½®ã€‚

```shell
[program:manager]
directory = /home/web ; ç¨‹åºçš„å¯åŠ¨ç›®å½•
command = java -jar manager.jar ; å¯åŠ¨å‘½ä»¤ï¼Œä¸å‘½ä»¤è¡Œå¯åŠ¨çš„å‘½ä»¤æ˜¯ä¸€æ ·çš„
autostart = true     ; åœ¨ supervisord å¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨
startsecs = 5        ; å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†
autorestart = true   ; ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯
startretries = 3     ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3
user = root          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨
redirect_stderr = true  ; æŠŠ stderr é‡å®šå‘åˆ° stdoutï¼Œé»˜è®¤ false
stdout_logfile_maxbytes = 20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MB
stdout_logfile_backups = 20     ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°
; stdout æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼ˆsupervisord ä¼šè‡ªåŠ¨åˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼‰
stdout_logfile = /etc/supervisord.d/log/manager.log  ;æ—¥å¿—ç»Ÿä¸€æ”¾åœ¨logç›®å½•ä¸‹
; å¯ä»¥é€šè¿‡ environment æ¥æ·»åŠ éœ€è¦çš„ç¯å¢ƒå˜é‡ï¼Œä¸€ç§å¸¸è§çš„ç”¨æ³•æ˜¯ä¿®æ”¹ PYTHONPATH
; environment=PYTHONPATH=$PYTHONPATH:/path/to/somewhere
```

å½“ç„¶ï¼Œè¿™éƒ½æ˜¯ä¸€äº›æˆ‘ä»¬åŸºæœ¬çš„é…ç½®ï¼Œæ›´å¤šé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[å®˜ç½‘][7]æŸ¥çœ‹ã€‚

(3) ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶

ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œä½¿å…¶åŒ…å«æˆ‘ä»¬è‡ªå®šä¹‰çš„åº”ç”¨é…ç½®æ–‡ä»¶ã€‚

```shell
$ vim /etc/supervisord.conf   åœ¨æœ€åä¸€è¡Œ
[include]
files = supervisord.d/conf/*.conf
```

(4) åŠ è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½¿å…¶ç”Ÿæ•ˆ

```shell
// é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
$ supervisorctl reread

// å°†é…ç½®æ–‡ä»¶é‡Œæ–°å¢çš„å­è¿›ç¨‹åŠ å…¥è¿›ç¨‹ç»„ï¼Œå¦‚æœè®¾ç½®äº†autostart=trueåˆ™ä¼šå¯åŠ¨æ–°æ–°å¢çš„å­è¿›ç¨‹
$ supervisorctl update
```

å…¶ä»–å¸¸ç”¨å‘½ä»¤ï¼š

```shell
// other
$ supervisorctl status
$ supervisorctl stop <program_name>
$ supervisorctl start <program_name>
$ supervisorctl restart <program_name>
$ supervisorctl remove <program_name>
```

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¾“å…¥å‘½ä»¤ `supervisorctl` è¿›å…¥ `supervisorctl` çš„ `shell` äº¤äº’ç•Œé¢ï¼ˆè¿˜æ˜¯çº¯å‘½ä»¤è¡ŒğŸ˜“ï¼‰ï¼Œå°±å¯ä»¥åœ¨ä¸‹é¢è¾“å…¥å‘½ä»¤äº†ã€‚

å‚è€ƒæ–‡ç« ï¼š

- [å®˜ç½‘][7]
- [Supervisor ä¸ºæœåŠ¡åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹][8]
- [Supervisorä½¿ç”¨æ•™ç¨‹][9]
- [Spring Boot é¡¹ç›®è‡ªåŠ¨å‘å¸ƒä¸Supervisor][10]

[1]: https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html
[2]: https://www.infoq.cn/article/Q-ese4CxV2IWmltsJcGX
[3]: http://blog.didispace.com/spring-boot-learning-21-1-3/
[4]: https://www.cnblogs.com/yueshutong/p/10025820.html
[5]: https://my.oschina.net/ManderSY/blog/1576936
[6]: https://zhongwuzw.github.io/2016/12/02/%E8%A7%A3%E5%86%B3https%E6%B7%B7%E5%90%88http%E7%9A%84%E9%97%AE%E9%A2%98/
[7]: http://supervisord.org/
[8]: https://www.cnblogs.com/along21/p/10255681.html
[9]: https://juejin.im/entry/5c1f01616fb9a049cd543042
[10]: https://www.jianshu.com/p/866a755e2c2d
